<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GinecoSpa - Check-in emocional. Descubre qu√© est√° pasando contigo realmente y recibe orientaci√≥n personalizada.">
    <title>GinecoSpa - ¬øQu√© est√° pasando contigo realmente?</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ============================================
           CSS VARIABLES - PALETA ROSADA PREMIUM
           ============================================ */
        :root {
            --rosa-palido: #FFF5F7;
            --rosa-claro: #FFE5EC;
            --rosa-medio: #FFB5C5;
            --rosa-intenso: #FF8FA3;
            --rosa-oscuro: #E75480;
            --rosa-profundo: #C9365E;
            --coral: #FF9B9B;
            --lavanda: #F3E8FF;
            --lavanda-medio: #E0CFFF;
            --gris-calido: #6B5D5D;
            --gris-suave: #9A8F8F;
            --crema: #FFF8F0;
            --blanco: #FFFFFF;
            --texto-principal: #3D2E2E;
            --texto-secundario: #7A6B6B;
            --sombra-rosa: rgba(231, 84, 128, 0.12);
            --sombra-suave: rgba(61, 46, 46, 0.06);
            --gradiente-hero: linear-gradient(135deg, #FFF5F7 0%, #FFE5EC 30%, #F3E8FF 70%, #FFF5F7 100%);
            --gradiente-boton: linear-gradient(135deg, #E75480 0%, #FF8FA3 100%);
            --gradiente-boton-hover: linear-gradient(135deg, #C9365E 0%, #E75480 100%);
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            /* Emotional panel colors */
            --color-equilibrio: #4CAF7A;
            --color-tension: #E5A822;
            --color-acumulacion: #D4803A;
        }

        /* ============================================
           RESET & BASE
           ============================================ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--texto-principal);
            background: var(--gradiente-hero);
            background-attachment: fixed;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            line-height: 1.2;
        }

        .font-script {
            font-family: 'Dancing Script', cursive;
        }

        /* ============================================
           BACKGROUND DECORATIONS
           ============================================ */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }

        .bg-orb-1 {
            width: 400px;
            height: 400px;
            background: var(--rosa-claro);
            top: -100px;
            right: -100px;
            animation: orbFloat 12s ease-in-out infinite;
        }

        .bg-orb-2 {
            width: 350px;
            height: 350px;
            background: var(--lavanda);
            bottom: -80px;
            left: -80px;
            animation: orbFloat 15s ease-in-out infinite reverse;
        }

        .bg-orb-3 {
            width: 250px;
            height: 250px;
            background: var(--rosa-medio);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: orbFloat 10s ease-in-out infinite 2s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -20px) scale(1.05); }
            66% { transform: translate(-20px, 15px) scale(0.95); }
        }

        /* ============================================
           LAYOUT - MAIN CONTAINER
           ============================================ */
        .app-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 1rem;
        }

        /* ============================================
           HEADER / BRAND
           ============================================ */
        .brand-header {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: fadeSlideDown 0.8s var(--transition-smooth);
        }

        .brand-header .logo-text {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--rosa-oscuro);
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .brand-header .logo-text:hover {
            opacity: 0.8;
        }

        .brand-header .subtitle {
            font-size: 0.75rem;
            color: var(--gris-suave);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 0.25rem;
        }

        /* ============================================
           WIZARD CARD
           ============================================ */
        .wizard-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 229, 236, 0.6);
            border-radius: 28px;
            box-shadow:
                0 4px 24px var(--sombra-rosa),
                0 1px 3px var(--sombra-suave);
            width: 100%;
            max-width: 640px;
            padding: 2rem 1.5rem;
            position: relative;
            overflow: hidden;
            transition: box-shadow 0.3s var(--transition-smooth);
        }

        .wizard-card:hover {
            box-shadow:
                0 8px 40px var(--sombra-rosa),
                0 2px 6px var(--sombra-suave);
        }

        .wizard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradiente-boton);
            border-radius: 28px 28px 0 0;
        }

        @media (min-width: 640px) {
            .wizard-card {
                padding: 2.5rem 3rem;
            }
        }

        /* ============================================
           PROGRESS BAR
           ============================================ */
        .progress-wrapper {
            margin-bottom: 2rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .progress-step {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--rosa-oscuro);
            letter-spacing: 0.5px;
        }

        .progress-percentage {
            font-size: 0.75rem;
            color: var(--gris-suave);
            font-weight: 500;
        }

        .progress-bar-track {
            width: 100%;
            height: 6px;
            background: var(--rosa-claro);
            border-radius: 100px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--gradiente-boton);
            border-radius: 100px;
            transition: width 0.5s var(--transition-smooth);
            position: relative;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ============================================
           QUESTION SCREEN
           ============================================ */
        .question-screen {
            position: relative;
            min-height: 320px;
        }

        .question-slide {
            animation: slideIn 0.45s var(--transition-smooth);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInReverse {
            from { opacity: 0; transform: translateX(-40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeSlideDown {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .question-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
            animation: floatIcon 3s ease-in-out infinite;
        }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .question-category {
            font-family: 'Dancing Script', cursive;
            font-size: 1.1rem;
            color: var(--rosa-oscuro);
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .question-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--texto-principal);
            margin-bottom: 1.5rem;
            line-height: 1.35;
        }

        @media (min-width: 640px) {
            .question-text {
                font-size: 1.6rem;
            }
        }

        /* ============================================
           RADIO OPTIONS
           ============================================ */
        .options-group {
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
            margin-bottom: 1.25rem;
        }

        .option-item {
            position: relative;
        }

        .option-item input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 0.85rem;
            padding: 0.9rem 1.1rem;
            background: var(--blanco);
            border: 2px solid var(--rosa-claro);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s var(--transition-smooth);
            font-size: 0.9rem;
            color: var(--texto-principal);
            user-select: none;
        }

        .option-label:hover {
            border-color: var(--rosa-medio);
            background: var(--rosa-palido);
            transform: translateY(-1px);
            box-shadow: 0 2px 12px var(--sombra-rosa);
        }

        .option-radio-circle {
            width: 22px;
            height: 22px;
            min-width: 22px;
            border-radius: 50%;
            border: 2px solid var(--rosa-medio);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s var(--transition-smooth);
        }

        .option-radio-circle::after {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--rosa-oscuro);
            transform: scale(0);
            transition: transform 0.25s var(--transition-smooth);
        }

        .option-item input[type="radio"]:checked + .option-label {
            border-color: var(--rosa-oscuro);
            background: linear-gradient(135deg, var(--rosa-palido), rgba(255, 229, 236, 0.5));
            box-shadow: 0 2px 16px var(--sombra-rosa);
        }

        .option-item input[type="radio"]:checked + .option-label .option-radio-circle {
            border-color: var(--rosa-oscuro);
            background: var(--rosa-palido);
        }

        .option-item input[type="radio"]:checked + .option-label .option-radio-circle::after {
            transform: scale(1);
        }

        .option-item input[type="radio"]:checked + .option-label .option-check {
            opacity: 1;
            transform: scale(1);
        }

        .option-check {
            margin-left: auto;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.25s var(--transition-smooth);
            color: var(--rosa-oscuro);
            font-size: 1rem;
        }

        .option-item input[type="radio"]:focus-visible + .option-label {
            outline: 3px solid var(--rosa-intenso);
            outline-offset: 2px;
        }

        /* ============================================
           OBSERVATIONS TEXTAREA
           ============================================ */
        .observations-wrapper {
            margin-bottom: 1.5rem;
        }

        .observations-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--gris-suave);
            transition: color 0.2s;
            padding: 0.3rem 0;
            background: none;
            border: none;
            font-family: 'Montserrat', sans-serif;
        }

        .observations-toggle:hover {
            color: var(--rosa-oscuro);
        }

        .observations-toggle svg {
            transition: transform 0.3s var(--transition-smooth);
        }

        .observations-toggle.active svg {
            transform: rotate(180deg);
        }

        .observations-area {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s var(--transition-smooth), opacity 0.3s;
            opacity: 0;
        }

        .observations-area.open {
            max-height: 150px;
            opacity: 1;
            margin-top: 0.5rem;
        }

        .observations-area textarea {
            width: 100%;
            min-height: 70px;
            padding: 0.8rem 1rem;
            border: 2px solid var(--rosa-claro);
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.85rem;
            color: var(--texto-principal);
            background: var(--blanco);
            resize: vertical;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }

        .observations-area textarea:focus {
            border-color: var(--rosa-intenso);
            box-shadow: 0 0 0 3px rgba(231, 84, 128, 0.1);
        }

        .observations-area textarea::placeholder {
            color: var(--gris-suave);
            font-style: italic;
        }

        /* ============================================
           VALIDATION MESSAGE
           ============================================ */
        .validation-msg {
            display: none;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            color: var(--rosa-oscuro);
            margin-bottom: 1rem;
            padding: 0.5rem 0.8rem;
            background: rgba(231, 84, 128, 0.08);
            border-radius: 8px;
            animation: fadeSlideUp 0.3s var(--transition-smooth);
        }

        .validation-msg.show {
            display: flex;
        }

        /* ============================================
           NAVIGATION BUTTONS
           ============================================ */
        .nav-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: space-between;
            margin-top: 0.5rem;
        }

        .btn {
            padding: 0.85rem 1.8rem;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s var(--transition-smooth);
            border: none;
            outline: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn:focus-visible {
            outline: 3px solid var(--rosa-intenso);
            outline-offset: 3px;
        }

        .btn-prev {
            background: var(--blanco);
            color: var(--gris-calido);
            border: 2px solid var(--rosa-claro);
        }

        .btn-prev:hover {
            border-color: var(--rosa-medio);
            background: var(--rosa-palido);
            color: var(--rosa-oscuro);
        }

        .btn-next {
            background: var(--gradiente-boton);
            color: var(--blanco);
            box-shadow: 0 4px 16px rgba(231, 84, 128, 0.3);
            flex: 1;
            justify-content: center;
        }

        .btn-next:hover {
            background: var(--gradiente-boton-hover);
            box-shadow: 0 6px 24px rgba(231, 84, 128, 0.4);
            transform: translateY(-1px);
        }

        .btn-next:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(231, 84, 128, 0.3);
        }

        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-arrow {
            transition: transform 0.2s;
        }

        .btn-next:hover .btn-arrow {
            transform: translateX(3px);
        }

        .btn-prev:hover .btn-arrow-back {
            transform: translateX(-3px);
        }

        /* ============================================
           WELCOME SCREEN
           ============================================ */
        .welcome-screen {
            text-align: center;
            padding: 1rem 0;
            animation: scaleIn 0.6s var(--transition-smooth);
        }

        .welcome-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            display: block;
            animation: floatIcon 4s ease-in-out infinite;
        }

        .welcome-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--texto-principal);
            margin-bottom: 0.75rem;
        }

        .welcome-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.1rem;
            color: var(--rosa-oscuro);
            margin-bottom: 1.25rem;
        }

        .welcome-text {
            font-size: 0.9rem;
            color: var(--texto-secundario);
            margin-bottom: 2rem;
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
        }

        .welcome-features {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .welcome-feature {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            color: var(--gris-suave);
        }

        .welcome-feature span:first-child {
            font-size: 1.3rem;
        }

        .btn-start {
            background: var(--gradiente-boton);
            color: var(--blanco);
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(231, 84, 128, 0.3);
            transition: all 0.3s var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-start:hover {
            background: var(--gradiente-boton-hover);
            box-shadow: 0 8px 32px rgba(231, 84, 128, 0.4);
            transform: translateY(-2px);
        }

        /* ============================================
           ANALYZING SCREEN
           ============================================ */
        .analyzing-screen {
            text-align: center;
            padding: 3rem 1rem;
            animation: fadeIn 0.5s var(--transition-smooth);
        }

        .analyzing-spinner {
            width: 64px;
            height: 64px;
            border: 4px solid var(--rosa-claro);
            border-top-color: var(--rosa-oscuro);
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .analyzing-dots {
            display: inline-flex;
            gap: 4px;
            margin-left: 4px;
        }

        .analyzing-dots span {
            width: 5px;
            height: 5px;
            background: var(--rosa-oscuro);
            border-radius: 50%;
            animation: dotPulse 1.4s ease-in-out infinite;
        }

        .analyzing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .analyzing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotPulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        .analyzing-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            color: var(--texto-principal);
            margin-bottom: 0.5rem;
        }

        .analyzing-subtext {
            font-size: 0.85rem;
            color: var(--gris-suave);
        }

        /* ============================================
           RESULTS SCREEN
           ============================================ */
        .results-screen {
            animation: fadeSlideUp 0.6s var(--transition-smooth);
        }

        .results-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .results-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 0.75rem;
        }

        .results-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.6rem;
            color: var(--texto-principal);
            margin-bottom: 0.25rem;
        }

        .results-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1rem;
            color: var(--rosa-oscuro);
        }

        /* Level Badge */
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 1rem auto;
        }

        .level-ajuste {
            background: linear-gradient(135deg, #E8F8F0, #D4EFDF);
            color: #2E7D5B;
            border: 1px solid #B8E6CC;
        }

        .level-carga {
            background: linear-gradient(135deg, #FFF8E1, #FFECB3);
            color: #C77A00;
            border: 1px solid #FFD54F;
        }

        .level-desgaste {
            background: linear-gradient(135deg, #FFEBEE, #FFCDD2);
            color: #C62828;
            border: 1px solid #EF9A9A;
        }

        .level-saturacion {
            background: linear-gradient(135deg, #EDE7F6, #D1C4E9);
            color: #6A1B9A;
            border: 1px solid #CE93D8;
        }

        .results-message {
            font-size: 0.9rem;
            color: var(--texto-secundario);
            line-height: 1.7;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        /* Recommendations */
        .recommendations {
            background: var(--rosa-palido);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .recommendations h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--texto-principal);
            margin-bottom: 0.75rem;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.5rem 0;
            font-size: 0.85rem;
            color: var(--texto-secundario);
            line-height: 1.5;
        }

        .recommendation-item span:first-child {
            font-size: 1rem;
            flex-shrink: 0;
            margin-top: 1px;
        }

        /* Divider */
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--rosa-claro), transparent);
            margin: 1.5rem 0;
        }

        /* ============================================
           FOTO vs PELICULA BLOCK
           ============================================ */
        .foto-pelicula {
            background: linear-gradient(135deg, var(--lavanda), var(--rosa-palido));
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .foto-pelicula h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.25rem;
            color: var(--texto-principal);
            margin-bottom: 0.5rem;
        }

        .foto-pelicula p {
            font-size: 0.85rem;
            color: var(--texto-secundario);
            line-height: 1.6;
        }

        /* ============================================
           RESUMEN PERSONALIZADO
           ============================================ */
        .resumen-personal {
            background: var(--blanco);
            border: 2px solid var(--rosa-claro);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .resumen-personal h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--rosa-oscuro);
            margin-bottom: 0.75rem;
        }

        .resumen-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.4rem 0;
            font-size: 0.85rem;
            color: var(--texto-principal);
            line-height: 1.5;
        }

        .resumen-item strong {
            color: var(--rosa-oscuro);
            font-weight: 600;
        }

        /* ============================================
           PREVIEW BLOQUEADO
           ============================================ */
        .locked-preview {
            position: relative;
            background: var(--blanco);
            border: 2px solid var(--lavanda-medio);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .locked-preview-visible {
            margin-bottom: 0.75rem;
        }

        .locked-preview-visible p {
            font-size: 0.85rem;
            color: var(--texto-principal);
            line-height: 1.6;
            margin-bottom: 0.3rem;
        }

        .locked-preview-visible p strong {
            color: var(--rosa-oscuro);
        }

        .locked-preview-blurred {
            filter: blur(6px);
            user-select: none;
            pointer-events: none;
            padding: 0.5rem 0;
        }

        .locked-preview-blurred p {
            font-size: 0.85rem;
            color: var(--texto-secundario);
            line-height: 1.6;
            margin-bottom: 0.3rem;
        }

        .locked-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70%;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.95));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 1.25rem;
        }

        .lock-icon {
            font-size: 1.5rem;
            margin-bottom: 0.4rem;
        }

        .lock-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--rosa-oscuro);
        }

        /* Unlock includes */
        .unlock-includes {
            background: var(--rosa-palido);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
        }

        .unlock-includes h5 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            color: var(--texto-principal);
            margin-bottom: 0.6rem;
        }

        .unlock-includes ul {
            list-style: none;
            padding: 0;
        }

        .unlock-includes li {
            font-size: 0.82rem;
            color: var(--texto-secundario);
            padding: 0.25rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .unlock-includes li span:first-child {
            font-size: 0.9rem;
        }

        /* ============================================
           CTA UNLOCK
           ============================================ */
        .cta-unlock {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .cta-unlock p {
            font-size: 0.85rem;
            color: var(--gris-suave);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .btn-unlock {
            background: var(--gradiente-boton);
            color: var(--blanco);
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(231, 84, 128, 0.3);
            transition: all 0.3s var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-unlock:hover {
            background: var(--gradiente-boton-hover);
            box-shadow: 0 8px 32px rgba(231, 84, 128, 0.4);
            transform: translateY(-2px);
        }

        /* ============================================
           RESTART BUTTON
           ============================================ */
        .btn-restart {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-top: 1.5rem;
            font-size: 0.8rem;
            color: var(--gris-suave);
            background: none;
            border: none;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            transition: color 0.2s;
        }

        .btn-restart:hover {
            color: var(--rosa-oscuro);
        }

        /* ============================================
           FOOTER
           ============================================ */
        .app-footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
            font-size: 0.7rem;
            color: var(--gris-suave);
        }

        .app-footer a {
            color: var(--rosa-oscuro);
            text-decoration: none;
        }

        .app-footer .disclaimer {
            max-width: 500px;
            margin: 0.5rem auto 0;
            line-height: 1.5;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        /* ============================================
           MICRO-MESSAGES (between questions)
           ============================================ */
        .micro-message-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 245, 247, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            opacity: 0;
            animation: microFadeIn 0.4s var(--transition-smooth) forwards;
        }

        .micro-message-overlay.micro-fade-out {
            animation: microFadeOut 0.4s var(--transition-smooth) forwards;
        }

        @keyframes microFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes microFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .micro-message-content {
            text-align: center;
            padding: 2rem;
            max-width: 400px;
            animation: microSlideUp 0.5s var(--transition-smooth) 0.15s both;
        }

        @keyframes microSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .micro-message-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 1rem;
            animation: floatIcon 3s ease-in-out infinite;
        }

        .micro-message-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.35rem;
            font-weight: 500;
            color: var(--texto-principal);
            line-height: 1.5;
        }

        .micro-message-sub {
            font-size: 0.8rem;
            color: var(--gris-suave);
            margin-top: 0.75rem;
            font-style: italic;
        }

        /* ============================================
           PANEL DE ESTADO EMOCIONAL
           ============================================ */
        .emotional-panel {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(243,232,255,0.4));
            border: 2px solid var(--lavanda-medio);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.75rem;
            animation: fadeSlideUp 0.6s var(--transition-smooth);
        }

        .emotional-panel-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.25rem;
            color: var(--texto-principal);
            text-align: center;
            margin-bottom: 0.4rem;
        }

        .emotional-panel-subtitle {
            font-size: 0.78rem;
            color: var(--gris-suave);
            text-align: center;
            margin-bottom: 1.25rem;
            font-style: italic;
        }

        .emotional-indicator {
            margin-bottom: 1rem;
        }

        .emotional-indicator:last-child {
            margin-bottom: 0;
        }

        .indicator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .indicator-label {
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--texto-principal);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .indicator-level {
            font-size: 0.72rem;
            font-weight: 600;
            padding: 0.15rem 0.6rem;
            border-radius: 50px;
        }

        .indicator-level-equilibrio {
            background: rgba(76, 175, 122, 0.12);
            color: var(--color-equilibrio);
        }

        .indicator-level-tension {
            background: rgba(229, 168, 34, 0.12);
            color: var(--color-tension);
        }

        .indicator-level-acumulacion {
            background: rgba(212, 128, 58, 0.12);
            color: var(--color-acumulacion);
        }

        .indicator-bar-track {
            width: 100%;
            height: 8px;
            background: var(--rosa-claro);
            border-radius: 100px;
            overflow: hidden;
        }

        .indicator-bar-fill {
            height: 100%;
            border-radius: 100px;
            transition: width 1.2s var(--transition-smooth);
            width: 0;
        }

        .indicator-bar-fill.bar-equilibrio {
            background: linear-gradient(90deg, #A8E6C3, var(--color-equilibrio));
        }

        .indicator-bar-fill.bar-tension {
            background: linear-gradient(90deg, #FFE082, var(--color-tension));
        }

        .indicator-bar-fill.bar-acumulacion {
            background: linear-gradient(90deg, #FFCC80, var(--color-acumulacion));
        }

        /* ============================================
           PRE-STRIPE ENHANCED TEXT
           ============================================ */
        .pre-stripe-text {
            text-align: center;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .pre-stripe-text p {
            font-size: 0.88rem;
            color: var(--texto-secundario);
            line-height: 1.65;
            margin-bottom: 0.6rem;
        }

        .pre-stripe-text p:last-child {
            margin-bottom: 0;
        }

        .pre-stripe-text .emphasis {
            color: var(--rosa-oscuro);
            font-weight: 600;
        }

        /* ============================================
           EMPATHIC CLOSING
           ============================================ */
        .empathic-closing {
            background: linear-gradient(135deg, var(--lavanda), rgba(255, 245, 247, 0.6));
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            border: 1px solid rgba(224, 207, 255, 0.5);
        }

        .empathic-closing-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.6rem;
        }

        .empathic-closing p {
            font-size: 0.85rem;
            color: var(--texto-secundario);
            line-height: 1.7;
            margin-bottom: 0.5rem;
        }

        .empathic-closing p:last-child {
            margin-bottom: 0;
        }

        .empathic-closing .script-text {
            font-family: 'Dancing Script', cursive;
            font-size: 1.05rem;
            color: var(--rosa-oscuro);
        }

        /* ============================================
           UTILITY
           ============================================ */
        .hidden {
            display: none !important;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--rosa-medio); border-radius: 100px; }
    </style>
</head>
<body>

    <!-- Background orbs -->
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>
    <div class="bg-orb bg-orb-3"></div>

    <div class="app-container">

        <!-- Brand -->
        <header class="brand-header">
            <a href="index.html" class="logo-text">GinecoSpa</a>
            <div class="subtitle">Check-in Emocional</div>
        </header>

        <!-- Wizard Card -->
        <main class="wizard-card" id="wizardCard" role="main" aria-label="Check-in emocional">

            <!-- ====== WELCOME SCREEN ====== -->
            <section id="welcomeScreen" class="welcome-screen" aria-label="Bienvenida">
                <span class="welcome-icon" aria-hidden="true">üîÆ</span>
                <h1 class="welcome-title">¬øQu√© est√° pasando contigo realmente?</h1>
                <p class="welcome-subtitle">Un espacio para escucharte</p>
                <p class="welcome-text">
                    No es un test. No hay respuestas correctas. Es un momento para conectar contigo
                    y dejar que algo que llevas dentro empiece a tomar forma.
                </p>
                <div class="welcome-features">
                    <div class="welcome-feature">
                        <span aria-hidden="true">üîí</span>
                        <span>Privado</span>
                    </div>
                    <div class="welcome-feature">
                        <span aria-hidden="true">‚è±Ô∏è</span>
                        <span>2-3 min</span>
                    </div>
                    <div class="welcome-feature">
                        <span aria-hidden="true">üíú</span>
                        <span>10 preguntas</span>
                    </div>
                </div>
                <button class="btn-start" id="btnStart" aria-label="Comenzar check-in">
                    Comenzar
                    <span class="btn-arrow" aria-hidden="true">‚Üí</span>
                </button>
            </section>

            <!-- ====== QUIZ SCREEN ====== -->
            <section id="quizScreen" class="hidden" aria-label="Preguntas del check-in">
                <div class="progress-wrapper">
                    <div class="progress-info">
                        <span class="progress-step" id="progressStep">Pregunta 1 de 10</span>
                        <span class="progress-percentage" id="progressPercent">10%</span>
                    </div>
                    <div class="progress-bar-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="10">
                        <div class="progress-bar-fill" id="progressFill" style="width: 10%"></div>
                    </div>
                </div>

                <div class="question-screen" id="questionContainer"></div>

                <div class="validation-msg" id="validationMsg" role="alert">
                    <span aria-hidden="true">üí°</span>
                    <span>Por favor, selecciona una opci√≥n para continuar</span>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-prev" id="btnPrev" aria-label="Pregunta anterior">
                        <span class="btn-arrow-back" aria-hidden="true">‚Üê</span>
                        Anterior
                    </button>
                    <button class="btn btn-next hidden" id="btnNext" aria-label="Siguiente pregunta">
                        Siguiente
                        <span class="btn-arrow" aria-hidden="true">‚Üí</span>
                    </button>
                </div>
            </section>

            <!-- ====== ANALYZING SCREEN ====== -->
            <section id="analyzingScreen" class="hidden" aria-label="Analizando respuestas">
                <div class="analyzing-screen">
                    <div class="analyzing-spinner" aria-hidden="true"></div>
                    <p class="analyzing-text" id="analyzingMainText">
                        Leyendo tus respuestas
                        <span class="analyzing-dots" aria-hidden="true">
                            <span></span><span></span><span></span>
                        </span>
                    </p>
                    <p class="analyzing-subtext" id="analyzingSubText">Preparando tu lectura personalizada</p>
                </div>
            </section>

            <!-- ====== RESULTS SCREEN ====== -->
            <section id="resultsScreen" class="hidden" aria-label="Resultados">
                <div class="results-screen" id="resultsContent">
                    <!-- Populated by JS -->
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>
                <a href="index.html" class="font-script" style="font-size: 0.9rem;">GinecoSpa</a>
                &nbsp;¬∑&nbsp; Bienestar √çntimo y Est√©tico
            </p>
            <p class="disclaimer">
                Este cuestionario no constituye un diagn√≥stico m√©dico ni sustituye la evaluaci√≥n profesional.
                Es una herramienta de orientaci√≥n general. Si sientes que necesitas ayuda, consulta con un especialista.
                No es emergencia.
            </p>
        </footer>

    </div>

    <!-- ============================================
         JAVASCRIPT - APP LOGIC
         ============================================ -->
    <script>
    (() => {
        'use strict';

        // ============================================
        // ENDPOINT (PEGAR URL DEL NUEVO WEB APP AQU√ç)
        // ============================================
        const ENDPOINT = "PEGAR_AQUI_URL_WEB_APP";

        // ============================================
        // MICRO-MESSAGES CONFIG
        // Phase 1 (after Q2, Q3): Validation
        // Phase 2 (after Q5, Q6): Conscious inquiry
        // Phase 3 (after Q8, Q9): Partial emotional reading
        // ============================================
        const microMessages = {
            2: {
                icon: 'üíú',
                text: 'Lo que sientes importa. No hay respuestas incorrectas aqu√≠.',
                sub: 'Sigue conectando contigo...'
            },
            5: {
                icon: 'üåä',
                text: 'Algo est√° tomando forma... tu cuerpo ya sabe lo que tu mente a√∫n no ha nombrado.',
                sub: 'Est√°s yendo m√°s profundo...'
            },
            8: {
                icon: 'ü™û',
                text: 'Tu lectura est√° casi lista. Lo que viene puede mostrarte algo que ya intu√≠as.',
                sub: 'Solo unas preguntas m√°s...'
            }
        };

        // ============================================
        // QUESTIONNAIRE DATA (10 preguntas, scoring 0-3)
        // ============================================
        const questions = [
            {
                id: 1, icon: 'üíú', category: 'Sentir interno',
                text: 'En este momento de tu vida, ¬øc√≥mo te sientes por dentro?',
                options: [
                    { label: 'Tranquilo/a y estable', score: 0 },
                    { label: 'Algo confundido/a', score: 1 },
                    { label: 'Cansado/a y saturado/a', score: 2 },
                    { label: 'Perdido/a o sin rumbo', score: 3 }
                ]
            },
            {
                id: 2, icon: '‚ö°', category: 'Energ√≠a',
                text: '¬øC√≥mo sientes tu energ√≠a en el d√≠a a d√≠a?',
                options: [
                    { label: 'Buena y constante', score: 0 },
                    { label: 'Variable', score: 1 },
                    { label: 'Baja la mayor parte del tiempo', score: 2 },
                    { label: 'Muy baja, me cuesta arrancar', score: 3 }
                ]
            },
            {
                id: 3, icon: 'üß≠', category: 'Claridad',
                text: 'Cuando piensas en tu vida actual, ¬øqu√© tan claro lo tienes?',
                options: [
                    { label: 'Bastante claro', score: 0 },
                    { label: 'M√°s o menos', score: 1 },
                    { label: 'Poco claro', score: 2 },
                    { label: 'Nada claro', score: 3 }
                ]
            },
            {
                id: 4, icon: 'üß†', category: 'Carga mental',
                text: '¬øQu√© tan cargada sientes tu mente √∫ltimamente?',
                options: [
                    { label: 'Ligera', score: 0 },
                    { label: 'Moderada', score: 1 },
                    { label: 'Bastante cargada', score: 2 },
                    { label: 'Saturada, no para', score: 3 }
                ]
            },
            {
                id: 5, icon: 'üåä', category: 'Emoci√≥n dominante',
                text: '¬øQu√© emoci√≥n aparece con m√°s frecuencia?',
                options: [
                    { label: 'Calma', score: 0 },
                    { label: 'Preocupaci√≥n', score: 1 },
                    { label: 'Tristeza', score: 2 },
                    { label: 'Frustraci√≥n', score: 3 }
                ]
            },
            {
                id: 6, icon: 'üéØ', category: 'Alineaci√≥n',
                text: '¬øSientes que tu vida actual est√° alineada con lo que quieres?',
                options: [
                    { label: 'S√≠, bastante', score: 0 },
                    { label: 'En parte', score: 1 },
                    { label: 'Poco', score: 2 },
                    { label: 'Nada', score: 3 }
                ]
            },
            {
                id: 7, icon: 'üèãÔ∏è', category: 'Responsabilidades',
                text: '¬øC√≥mo te pesan hoy tus responsabilidades?',
                options: [
                    { label: 'Las manejo bien', score: 0 },
                    { label: 'A veces me superan', score: 1 },
                    { label: 'Me pesan bastante', score: 2 },
                    { label: 'Me abruman', score: 3 }
                ]
            },
            {
                id: 8, icon: 'ü´ß', category: 'Espacio personal',
                text: '¬øCu√°nto espacio tienes para ti y lo que necesitas?',
                options: [
                    { label: 'Suficiente', score: 0 },
                    { label: 'Algo', score: 1 },
                    { label: 'Poco', score: 2 },
                    { label: 'Nada', score: 3 }
                ]
            },
            {
                id: 9, icon: 'ü§ù', category: 'Red de apoyo',
                text: '¬øSientes que puedes apoyarte en alguien cuando lo necesitas?',
                options: [
                    { label: 'S√≠', score: 0 },
                    { label: 'En parte', score: 1 },
                    { label: 'Muy poco', score: 2 },
                    { label: 'No', score: 3 }
                ]
            },
            {
                id: 10, icon: 'ü™û', category: 'Lectura interna',
                text: 'En el fondo, ¬øqu√© sientes que est√° pasando contigo?',
                options: [
                    { label: 'Estoy bien, solo ajust√°ndome', score: 0 },
                    { label: 'Necesito ordenar cosas', score: 1 },
                    { label: 'Algo importante pide atenci√≥n', score: 2 },
                    { label: 'Me siento desconectado/a de m√≠', score: 3 }
                ]
            }
        ];

        // ============================================
        // AREA LABELS (for top-2 areas display)
        // ============================================
        const areaLabels = [
            'Estabilidad emocional',
            'Energ√≠a vital',
            'Claridad de rumbo',
            'Carga mental',
            'Gesti√≥n emocional',
            'Alineaci√≥n con prop√≥sito',
            'Peso de responsabilidades',
            'Espacio personal',
            'Red de apoyo',
            'Conexi√≥n interna'
        ];

        // ============================================
        // PROFILES
        // ============================================
        const profiles = {
            A: {
                label: 'Ajuste saludable',
                icon: 'üåø',
                badgeClass: 'level-ajuste',
                title: 'Est√°s en un buen momento',
                message: `Lo que reflejan tus respuestas es que est√°s en una etapa de ajuste natural. No todo tiene que ser perfecto para que las cosas est√©n bien. A veces lo que sentimos es simplemente el pulso normal de una vida que se mueve, que cambia, que se adapta.\n\nNo necesitas arreglar nada urgente. Pero s√≠ vale la pena que cuides lo que ya funciona, porque es desde ah√≠ donde se construye lo que viene.`,
                recommendations: [
                    { icon: 'üå±', text: 'Protege tus rutinas de descanso y los peque√±os momentos que te recargan. Son tu base.' },
                    { icon: 'üìù', text: 'Dedica 5 minutos al d√≠a a revisar c√≥mo te sientes. Un diario breve puede ser revelador.' },
                    { icon: 'üå∏', text: 'Perm√≠tete disfrutar lo que ya tienes. No todo necesita ser "m√°s" para ser suficiente.' }
                ],
                closing: 'Sin embargo, incluso cuando estamos bien, hay matices que a veces no vemos. ¬øQu√© est√° debajo de ese equilibrio? ¬øHay algo que est√°s sosteniendo sin darte cuenta?'
            },
            B: {
                label: 'Carga moderada',
                icon: 'üå§Ô∏è',
                badgeClass: 'level-carga',
                title: 'Est√°s cargando m√°s de lo que crees',
                message: `Puede que desde fuera todo parezca "normal", pero por dentro hay algo que pesa. No es alarma, pero tampoco es para ignorar. Lo que sientes tiene sentido: tu cuerpo y tu mente est√°n pidiendo un ajuste, un respiro, un orden diferente.\n\nEste es el tipo de momento donde hacer una pausa a tiempo puede evitar que la carga se acumule hasta el punto de quiebre.`,
                recommendations: [
                    { icon: 'üéØ', text: 'Identifica 1 cosa que puedas soltar o delegar esta semana. No tienes que cargar todo.' },
                    { icon: 'ü´ß', text: 'Bloquea al menos 30 minutos al d√≠a que sean solo para ti. Sin culpa, sin productividad.' },
                    { icon: 'üí¨', text: 'Habla con alguien de confianza sobre lo que est√°s sintiendo. Decirlo en voz alta ya es un primer paso.' }
                ],
                closing: 'Lo que ves aqu√≠ es un primer vistazo. Pero detr√°s de la carga hay patrones, fugas de energ√≠a, y prioridades que a√∫n no est√°s viendo con claridad.'
            },
            C: {
                label: 'Desgaste emocional',
                icon: 'üåßÔ∏è',
                badgeClass: 'level-desgaste',
                title: 'Tu cuerpo ya te est√° hablando',
                message: `Hay se√±ales claras de que llevas un tiempo funcionando con m√°s peso del que deber√≠as cargar. No es que est√©s "mal" ‚Äî es que est√°s sosteniendo demasiado durante demasiado tiempo, y eso tiene un costo.\n\nLo m√°s importante ahora no es resolver todo, sino dejar de ignorar lo que sientes. Tu agotamiento no es debilidad ‚Äî es informaci√≥n.`,
                recommendations: [
                    { icon: 'üõë', text: 'Para. Antes de seguir haciendo, necesitas entender qu√© est√°s sintiendo y por qu√©.' },
                    { icon: 'üîã', text: 'Prioriza dormir bien y comer bien esta semana. Tu sistema nervioso necesita lo b√°sico.' },
                    { icon: 'ü§ù', text: 'Considera hablar con un profesional. No porque est√©s "mal", sino porque mereces claridad.' }
                ],
                closing: 'Tus respuestas revelan un patr√≥n m√°s profundo. Hay algo que te drena, algo que necesitas recuperar, y un paso que es m√°s urgente que los dem√°s.'
            },
            D: {
                label: 'Saturaci√≥n / desconexi√≥n',
                icon: 'üåë',
                badgeClass: 'level-saturacion',
                title: 'Necesitas atenci√≥n, y est√° bien',
                message: `Lo que muestran tus respuestas es que est√°s en un punto donde ya no se trata de "aguantar un poco m√°s". Hay una desconexi√≥n importante entre lo que necesitas y lo que est√°s viviendo, y eso puede sentirse como vac√≠o, confusi√≥n o agotamiento profundo.\n\nEste no es un resultado para asustarte ‚Äî es para validarte. Lo que sientes es real, tiene causas, y tiene soluci√≥n. Pero necesitas apoyo, no solo fuerza de voluntad.`,
                recommendations: [
                    { icon: 'ü©∫', text: 'Busca ayuda profesional esta semana. No ma√±ana, no "cuando pueda" ‚Äî esta semana.' },
                    { icon: 'ü§ç', text: 'Deja de exigirte funcionar como si todo estuviera bien. Perm√≠tete sentir lo que sientes.' },
                    { icon: 'ü´Ç', text: 'Ac√©rcate a una persona de confianza. No tienes que explicar todo ‚Äî solo necesitas no estar solo/a.' }
                ],
                closing: 'Lo que ves aqu√≠ es la superficie. Debajo hay un patr√≥n que explica mucho de lo que sientes, y un camino para empezar a reconectarte contigo.'
            }
        };

        // ============================================
        // DETERMINISTIC PATTERNS
        // ============================================
        const patternRules = [
            {
                id: 'saturacion_cero_pausa',
                check: (a) => a[3] >= 2 && a[7] >= 2,
                name: 'Saturaci√≥n + cero pausa',
                signal: 'Tu mente no para y no tienes espacio para ti. Es como intentar llenar un vaso que ya est√° rebosando.',
                step: 'Necesitas crear un espacio de silencio diario ‚Äî aunque sean 10 minutos. Tu sistema nervioso lo necesita.'
            },
            {
                id: 'sostener_sola',
                check: (a) => a[8] >= 2 && (a[4] >= 2 || a[9] >= 2),
                name: 'Sostener sola / desconexi√≥n emocional',
                signal: 'Llevas demasiado tiempo sosteniendo sin pedir ayuda. La tristeza o desconexi√≥n son se√±ales de que necesitas red.',
                step: 'Habla con alguien esta semana. No para pedir soluciones, sino para dejar de cargar en silencio.'
            },
            {
                id: 'desconexion_rumbo',
                check: (a) => a[2] >= 2 && a[9] >= 2,
                name: 'Desconexi√≥n de rumbo',
                signal: 'No es que no puedas ‚Äî es que no sabes hacia d√≥nde ir. La falta de claridad drena m√°s que el esfuerzo.',
                step: 'Antes de hacer m√°s, necesitas detenerte y preguntarte: ¬øqu√© quiero realmente?'
            },
            {
                id: 'desgaste_carga',
                check: (a) => a[1] >= 2 && a[6] >= 2,
                name: 'Desgaste por carga sostenida',
                signal: 'Tu energ√≠a baja y tus responsabilidades altas est√°n creando un ciclo de agotamiento que se autoalimenta.',
                step: 'Identifica 1 responsabilidad que puedas soltar o delegar esta semana. Tu energ√≠a es limitada.'
            }
        ];

        const defaultPattern = {
            id: 'ajuste_transicion',
            name: 'Ajuste interno / transici√≥n',
            signal: 'Est√°s en un momento de reacomodaci√≥n natural. Las cosas se est√°n moviendo, pero a√∫n no encuentras el nuevo equilibrio.',
            step: 'S√© paciente contigo. El ajuste lleva tiempo, y reconocerlo ya es avanzar.'
        };

        // ============================================
        // FOCUS RULES (deterministic)
        // ============================================
        function getFocus(profile, topAreas) {
            if (profile === 'D') return 'Recuperar conexi√≥n contigo antes de intentar resolver lo externo.';
            if (profile === 'C') return 'Frenar el desgaste: descanso, l√≠mites, y una conversaci√≥n honesta contigo.';
            if (topAreas.includes(3) || topAreas.includes(7)) return 'Reducir la sobrecarga mental y crear espacio para procesar.';
            if (topAreas.includes(8) || topAreas.includes(4)) return 'Reconectar con lo que sientes y necesitas realmente.';
            if (profile === 'B') return 'Ordenar prioridades y proteger tu energ√≠a antes de que se agote.';
            return 'Mantener lo que funciona y estar atento/a a lo que necesita ajuste.';
        }

        function getWeeklyPriority(profile, topAreas) {
            if (profile === 'D') return 'Hablar con un profesional o una persona de confianza.';
            if (profile === 'C') return 'Dormir 7+ horas y reducir 1 compromiso no esencial.';
            if (topAreas.includes(7)) return 'Soltar o delegar 1 responsabilidad concreta.';
            if (topAreas.includes(3)) return 'Dedicar 15 minutos al d√≠a a escribir lo que piensas sin filtro.';
            if (topAreas.includes(8)) return 'Bloquear 30 minutos al d√≠a solo para ti.';
            if (profile === 'B') return 'Identificar qu√© te drena m√°s energ√≠a y ponerle un l√≠mite.';
            return 'Dedicar tiempo a una actividad que te haga bien sin ninguna obligaci√≥n.';
        }

        // ============================================
        // EMOTIONAL INDICATORS CALCULATION
        // ============================================
        function calculateEmotionalIndicators(scores) {
            // 5 indicators mapped from the 10 questions
            // Each indicator: average of relevant question scores, scaled to percentage
            // Higher % = more accumulated (inverted for display as tension)

            const indicators = [
                {
                    id: 'carga_mental',
                    icon: 'üß†',
                    label: 'Carga mental actual',
                    // Q4 (carga mental) + Q3 (claridad)
                    value: Math.round(((scores[3] + scores[2]) / 6) * 100)
                },
                {
                    id: 'rumiacion',
                    icon: 'üí≠',
                    label: 'Rumiaci√≥n / sobrepensar',
                    // Q3 (claridad) + Q5 (emoci√≥n dominante)
                    value: Math.round(((scores[2] + scores[4]) / 6) * 100)
                },
                {
                    id: 'agotamiento',
                    icon: 'üòÆ‚Äçüí®',
                    label: 'Agotamiento emocional',
                    // Q1 (sentir interno) + Q2 (energ√≠a)
                    value: Math.round(((scores[0] + scores[1]) / 6) * 100)
                },
                {
                    id: 'desconexion',
                    icon: 'ü´Ä',
                    label: 'Desconexi√≥n emocional',
                    // Q10 (lectura interna) + Q9 (red de apoyo)
                    value: Math.round(((scores[9] + scores[8]) / 6) * 100)
                },
                {
                    id: 'recuperacion',
                    icon: 'üå±',
                    label: 'Capacidad de recuperaci√≥n',
                    // Q8 (espacio personal) + Q6 (alineaci√≥n) - INVERTED (high = good)
                    value: Math.round((1 - ((scores[7] + scores[5]) / 6)) * 100)
                }
            ];

            // Clamp values
            indicators.forEach(ind => {
                ind.value = Math.max(5, Math.min(95, ind.value));
                // Determine level (for first 4: high = bad; for recuperacion: high = good)
                if (ind.id === 'recuperacion') {
                    if (ind.value >= 60) { ind.level = 'Equilibrio'; ind.levelClass = 'equilibrio'; }
                    else if (ind.value >= 35) { ind.level = 'Tensi√≥n'; ind.levelClass = 'tension'; }
                    else { ind.level = 'Acumulaci√≥n'; ind.levelClass = 'acumulacion'; }
                } else {
                    if (ind.value <= 35) { ind.level = 'Equilibrio'; ind.levelClass = 'equilibrio'; }
                    else if (ind.value <= 60) { ind.level = 'Tensi√≥n'; ind.levelClass = 'tension'; }
                    else { ind.level = 'Acumulaci√≥n'; ind.levelClass = 'acumulacion'; }
                }
            });

            return indicators;
        }

        // ============================================
        // STATE
        // ============================================
        let currentStep = 0;
        let answers = new Array(questions.length).fill(null);
        let notes = new Array(questions.length).fill('');
        let direction = 'forward';
        let autoAdvanceTimeout = null;

        // ============================================
        // DOM
        // ============================================
        const $ = (sel) => document.querySelector(sel);
        const welcomeScreen = $('#welcomeScreen');
        const quizScreen = $('#quizScreen');
        const analyzingScreen = $('#analyzingScreen');
        const resultsScreen = $('#resultsScreen');

        const btnStart = $('#btnStart');
        const btnPrev = $('#btnPrev');
        const btnNext = $('#btnNext');

        const progressStep = $('#progressStep');
        const progressPercent = $('#progressPercent');
        const progressFill = $('#progressFill');
        const questionContainer = $('#questionContainer');
        const validationMsg = $('#validationMsg');

        // ============================================
        // SCREEN MANAGEMENT
        // ============================================
        function showScreen(screen) {
            [welcomeScreen, quizScreen, analyzingScreen, resultsScreen]
                .forEach(s => s.classList.add('hidden'));
            screen.classList.remove('hidden');
        }

        // ============================================
        // MICRO-MESSAGE DISPLAY
        // ============================================
        function showMicroMessage(questionIndex, callback) {
            const msg = microMessages[questionIndex];
            if (!msg) { callback(); return; }

            const overlay = document.createElement('div');
            overlay.className = 'micro-message-overlay';
            overlay.innerHTML = `
                <div class="micro-message-content">
                    <span class="micro-message-icon" aria-hidden="true">${msg.icon}</span>
                    <p class="micro-message-text">${msg.text}</p>
                    <p class="micro-message-sub">${msg.sub}</p>
                </div>
            `;
            document.body.appendChild(overlay);

            setTimeout(() => {
                overlay.classList.add('micro-fade-out');
                setTimeout(() => {
                    overlay.remove();
                    callback();
                }, 400);
            }, 2200);
        }

        // ============================================
        // AUTO-ADVANCE LOGIC
        // ============================================
        function handleAutoAdvance(questionIndex) {
            if (autoAdvanceTimeout) {
                clearTimeout(autoAdvanceTimeout);
                autoAdvanceTimeout = null;
            }

            autoAdvanceTimeout = setTimeout(() => {
                direction = 'forward';

                if (questionIndex < questions.length - 1) {
                    // Check if this question triggers a micro-message
                    const nextQNum = questionIndex + 1; // 0-indexed question just answered
                    if (microMessages[nextQNum]) {
                        showMicroMessage(nextQNum, () => {
                            currentStep++;
                            renderQuestion(currentStep - 1);
                        });
                    } else {
                        currentStep++;
                        renderQuestion(currentStep - 1);
                    }
                } else {
                    // Last question ‚Äî go to analyzing
                    goToAnalyzing();
                }
            }, 650);
        }

        // ============================================
        // RENDER QUESTION
        // ============================================
        function renderQuestion(index) {
            const q = questions[index];
            const selectedAnswer = answers[index];
            const currentNote = notes[index];

            const html = `
                <div class="question-slide" style="animation-name: ${direction === 'forward' ? 'slideIn' : 'slideInReverse'}">
                    <span class="question-icon" aria-hidden="true">${q.icon}</span>
                    <p class="question-category">${q.category}</p>
                    <h2 class="question-text">${q.text}</h2>
                    <div class="options-group" role="radiogroup" aria-label="${q.text}">
                        ${q.options.map((opt, i) => `
                            <div class="option-item">
                                <input
                                    type="radio"
                                    name="q${q.id}"
                                    id="q${q.id}_opt${i}"
                                    value="${i}"
                                    ${selectedAnswer === i ? 'checked' : ''}
                                    tabindex="0"
                                >
                                <label class="option-label" for="q${q.id}_opt${i}">
                                    <span class="option-radio-circle"></span>
                                    <span>${opt.label}</span>
                                    <span class="option-check" aria-hidden="true">‚úì</span>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="observations-wrapper">
                        <button
                            class="observations-toggle ${currentNote ? 'active' : ''}"
                            type="button"
                            aria-expanded="${currentNote ? 'true' : 'false'}"
                            id="obsToggle"
                        >
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                            Agregar observaci√≥n (opcional)
                        </button>
                        <div class="observations-area ${currentNote ? 'open' : ''}" id="obsArea">
                            <textarea
                                placeholder="Escribe aqu√≠ cualquier detalle que quieras agregar‚Ä¶"
                                aria-label="Observaciones opcionales"
                                id="obsTextarea"
                            >${currentNote}</textarea>
                        </div>
                    </div>
                </div>
            `;

            questionContainer.innerHTML = html;

            // Bind radios with auto-advance
            questionContainer.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    answers[index] = parseInt(e.target.value);
                    validationMsg.classList.remove('show');
                    // Auto-advance after selection
                    handleAutoAdvance(index);
                });
            });

            // Bind observation toggle
            const toggle = $('#obsToggle');
            const area = $('#obsArea');
            const textarea = $('#obsTextarea');

            toggle.addEventListener('click', () => {
                // If observation is opened, cancel auto-advance
                if (autoAdvanceTimeout) {
                    clearTimeout(autoAdvanceTimeout);
                    autoAdvanceTimeout = null;
                }
                const isOpen = area.classList.toggle('open');
                toggle.classList.toggle('active', isOpen);
                toggle.setAttribute('aria-expanded', isOpen);
                if (isOpen && textarea) textarea.focus();
                // Show Next button when observation is open so user can manually advance
                if (isOpen) {
                    btnNext.classList.remove('hidden');
                }
            });

            if (textarea) {
                textarea.addEventListener('input', (e) => {
                    notes[index] = e.target.value;
                });
            }

            updateProgress(index);
            btnPrev.style.display = index === 0 ? 'none' : 'inline-flex';
            // Hide Next button by default (auto-advance handles it)
            btnNext.classList.add('hidden');
            // But show it if already answered (user went back)
            if (selectedAnswer !== null) {
                btnNext.classList.remove('hidden');
            }
            btnNext.innerHTML = index === questions.length - 1
                ? 'Ver resultados <span class="btn-arrow" aria-hidden="true">‚Üí</span>'
                : 'Siguiente <span class="btn-arrow" aria-hidden="true">‚Üí</span>';
            validationMsg.classList.remove('show');
        }

        // ============================================
        // PROGRESS
        // ============================================
        function updateProgress(index) {
            const total = questions.length;
            const pct = Math.round(((index + 1) / total) * 100);
            progressStep.textContent = `Pregunta ${index + 1} de ${total}`;
            progressPercent.textContent = `${pct}%`;
            progressFill.style.width = `${pct}%`;
            progressFill.parentElement.setAttribute('aria-valuenow', pct);
        }

        // ============================================
        // CALCULATE RESULTS
        // ============================================
        function calculateResults() {
            const scores = answers.map((a, i) => a !== null ? questions[i].options[a].score : 0);
            const totalScore = scores.reduce((sum, s) => sum + s, 0);

            let profileKey;
            if (totalScore <= 7) profileKey = 'A';
            else if (totalScore <= 15) profileKey = 'B';
            else if (totalScore <= 23) profileKey = 'C';
            else profileKey = 'D';

            const profile = profiles[profileKey];

            const indexed = scores.map((s, i) => ({ index: i, score: s }));
            indexed.sort((a, b) => b.score - a.score || a.index - b.index);
            const topAreas = [indexed[0].index, indexed[1].index];

            let pattern = defaultPattern;
            for (const rule of patternRules) {
                if (rule.check(scores)) {
                    pattern = rule;
                    break;
                }
            }

            const focus = getFocus(profileKey, topAreas);
            const weeklyPriority = getWeeklyPriority(profileKey, topAreas);
            const emotionalIndicators = calculateEmotionalIndicators(scores);

            return {
                totalScore,
                profileKey,
                profile,
                scores,
                topAreas,
                pattern,
                focus,
                weeklyPriority,
                emotionalIndicators
            };
        }

        // ============================================
        // GO TO ANALYZING
        // ============================================
        function goToAnalyzing() {
            showScreen(analyzingScreen);
            const resultData = calculateResults();
            sendData(resultData);

            // Multi-step analyzing animation
            const mainText = $('#analyzingMainText');
            const subText = $('#analyzingSubText');

            const steps = [
                { main: 'Leyendo tus respuestas', sub: 'Conectando patrones emocionales...' },
                { main: 'Identificando se√±ales', sub: 'Mapeando tu estado interno...' },
                { main: 'Preparando tu lectura', sub: 'Tu lectura personal est√° casi lista...' }
            ];

            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                stepIndex++;
                if (stepIndex < steps.length) {
                    mainText.innerHTML = `${steps[stepIndex].main}<span class="analyzing-dots" aria-hidden="true"><span></span><span></span><span></span></span>`;
                    subText.textContent = steps[stepIndex].sub;
                }
            }, 1000);

            setTimeout(() => {
                clearInterval(stepInterval);
                showResults(resultData);
            }, 3200);
        }

        // ============================================
        // SHOW RESULTS
        // ============================================
        function showResults(r) {
            const content = $('#resultsContent');

            // Build emotional panel HTML
            const panelBarsHTML = r.emotionalIndicators.map(ind => `
                <div class="emotional-indicator">
                    <div class="indicator-header">
                        <span class="indicator-label">
                            <span aria-hidden="true">${ind.icon}</span> ${ind.label}
                        </span>
                        <span class="indicator-level indicator-level-${ind.levelClass}">${ind.level}</span>
                    </div>
                    <div class="indicator-bar-track">
                        <div class="indicator-bar-fill bar-${ind.levelClass}" data-width="${ind.id === 'recuperacion' ? ind.value : ind.value}"></div>
                    </div>
                </div>
            `).join('');

            content.innerHTML = `
                <div class="results-header">
                    <span class="results-icon" aria-hidden="true">${r.profile.icon}</span>
                    <h2 class="results-title">${r.profile.title}</h2>
                    <p class="results-subtitle">Tu lectura personal</p>
                </div>

                <!-- Level Badge -->
                <div style="text-align: center;">
                    <span class="level-badge ${r.profile.badgeClass}">
                        <span aria-hidden="true">${r.profile.icon}</span> ${r.profile.label}
                    </span>
                </div>

                <!-- Message -->
                <div class="results-message">${r.profile.message.replace(/\n/g, '<br>')}</div>

                <!-- Recommendations -->
                <div class="recommendations">
                    <h4>üí° Recomendaciones para este momento</h4>
                    ${r.profile.recommendations.map(rec => `
                        <div class="recommendation-item">
                            <span aria-hidden="true">${rec.icon}</span>
                            <span>${rec.text}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="divider"></div>

                <!-- PANEL DE ESTADO EMOCIONAL -->
                <div class="emotional-panel">
                    <h4 class="emotional-panel-title">Tu Estado Emocional Actual</h4>
                    <p class="emotional-panel-subtitle">Esto es lo que detectamos en tus respuestas</p>
                    ${panelBarsHTML}
                </div>

                <!-- Foto vs Pel√≠cula - IMPROVED -->
                <div class="foto-pelicula">
                    <h4>Esto es lo que se ve por fuera‚Ä¶ pero falta lo que pasa por dentro.</h4>
                    <p>
                        Cada barra que acabas de ver tiene una historia detr√°s. Hay conexiones entre lo que sientes,
                        lo que cargas y lo que necesitas que solo se ven cuando se conectan los puntos.
                        Lo que tienes aqu√≠ es la foto. El an√°lisis completo es la pel√≠cula.
                    </p>
                </div>

                <!-- Resumen Personalizado -->
                <div class="resumen-personal">
                    <h4>üîç Tu lectura r√°pida</h4>
                    <div class="resumen-item">
                        <span aria-hidden="true">üìå</span>
                        <span><strong>Tus 2 √°reas m√°s altas:</strong> ${areaLabels[r.topAreas[0]]} y ${areaLabels[r.topAreas[1]]}</span>
                    </div>
                    <div class="resumen-item">
                        <span aria-hidden="true">üéØ</span>
                        <span><strong>Tu foco principal hoy:</strong> ${r.focus}</span>
                    </div>
                    <div class="resumen-item">
                        <span aria-hidden="true">üìã</span>
                        <span><strong>Una prioridad para esta semana:</strong> ${r.weeklyPriority}</span>
                    </div>
                </div>

                <!-- Preview Bloqueado -->
                <div class="locked-preview">
                    <div class="locked-preview-visible">
                        <p><strong>Tu patr√≥n principal:</strong> ${r.pattern.name}</p>
                        <p><strong>Se√±al t√≠pica:</strong> ${r.pattern.signal}</p>
                        <p><strong>Primer paso sugerido:</strong> ${r.pattern.step}</p>
                    </div>
                    <div class="locked-preview-blurred">
                        <p><strong>Fuga de energ√≠a #1:</strong> Lo que m√°s te drena hoy no es lo que crees. Hay un patr√≥n oculto que conecta tu cansancio con una necesidad no atendida.</p>
                        <p><strong>Prioridad de reparaci√≥n:</strong> Antes de resolver lo urgente, necesitas atender lo que tu cuerpo lleva meses pidiendo en silencio.</p>
                        <p><strong>Plan de 7 d√≠as:</strong> Un plan paso a paso adaptado a tu perfil para empezar a sentir cambios reales esta semana.</p>
                        <p><strong>L√≠mites recomendados:</strong> Las 3 cosas que necesitas dejar de hacer para proteger tu energ√≠a y bienestar.</p>
                    </div>
                    <div class="locked-overlay">
                        <span class="lock-icon" aria-hidden="true">üîí</span>
                        <span class="lock-label">Desbloquea el an√°lisis completo</span>
                    </div>
                </div>

                <!-- Unlock Includes -->
                <div class="unlock-includes">
                    <h5>El an√°lisis completo incluye:</h5>
                    <ul>
                        <li><span aria-hidden="true">‚ú¶</span> Patr√≥n principal detallado</li>
                        <li><span aria-hidden="true">‚ú¶</span> Fuga de energ√≠a #1</li>
                        <li><span aria-hidden="true">‚ú¶</span> Prioridad de reparaci√≥n</li>
                        <li><span aria-hidden="true">‚ú¶</span> Plan personalizado de 7 d√≠as</li>
                        <li><span aria-hidden="true">‚ú¶</span> L√≠mites recomendados</li>
                    </ul>
                </div>

                <!-- PRE-STRIPE ENHANCED TEXT -->
                <div class="pre-stripe-text">
                    <p>Lo que acabas de ver apenas rasca la superficie. Tus respuestas revelaron patrones que
                    <span class="emphasis">conectan lo que sientes con lo que necesitas</span> ‚Äî pero esas conexiones
                    solo se ven en el an√°lisis completo.</p>
                    <p>No es m√°s informaci√≥n. Es <span class="emphasis">la pieza que falta</span> para entender
                    por qu√© te sientes as√≠ y qu√© hacer al respecto.</p>
                </div>

                <!-- CTA Unlock - PRESERVED EXACTLY -->
                <div class="cta-unlock">
                    <a href="https://buy.stripe.com/eVq6oI0h1czjfq4ckW5c40n" class="btn-unlock" target="_blank" rel="noopener">
                        Profundizar en mi an√°lisis
                        <span class="btn-arrow" aria-hidden="true">‚Üí</span>
                    </a>
                </div>

                <div class="divider"></div>

                <!-- EMPATHIC CLOSING -->
                <div class="empathic-closing">
                    <span class="empathic-closing-icon" aria-hidden="true">ü§ç</span>
                    <p>
                        Independientemente de lo que decidas, lo que hiciste hoy importa.
                        Tomarte estos minutos para escucharte ya es un acto de cuidado.
                    </p>
                    <p class="script-text">No est√°s sola en esto.</p>
                    <p>
                        Si necesitas hablar con alguien, estamos aqu√≠ para acompa√±arte.
                    </p>
                </div>

                <!-- Restart -->
                <div style="text-align: center;">
                    <button class="btn-restart" id="btnRestart">
                        <span aria-hidden="true">‚Ü∫</span> Realizar de nuevo
                    </button>
                </div>
            `;

            // Animate emotional bars after render
            setTimeout(() => {
                content.querySelectorAll('.indicator-bar-fill').forEach(bar => {
                    bar.style.width = bar.dataset.width + '%';
                });
            }, 200);

            // Bind restart
            $('#btnRestart').addEventListener('click', () => {
                currentStep = 0;
                answers = new Array(questions.length).fill(null);
                notes = new Array(questions.length).fill('');
                showScreen(welcomeScreen);
            });

            showScreen(resultsScreen);
        }

        // ============================================
        // SEND DATA TO BACKEND
        // ============================================
        function sendData(resultData) {
            const payload = {
                funnel: 'momento_vital_v1',
                timestamp: new Date().toISOString(),
                score_total: resultData.totalScore,
                perfil: resultData.profileKey,
                answers: answers.map((a, i) => ({
                    qId: i + 1,
                    optionLabel: a !== null ? questions[i].options[a].label : null,
                    score: a !== null ? questions[i].options[a].score : 0
                })),
                notes: notes.map((n, i) => ({ qId: i + 1, text: n })).filter(n => n.text),
                user: { name: '', email: '', whatsapp: '' },
                page_url: window.location.href,
                user_agent: navigator.userAgent,
                referrer: document.referrer || ''
            };

            // Save to localStorage as backup
            try {
                localStorage.setItem('ginecospa_momento_vital_backup', JSON.stringify(payload));
            } catch (e) { /* silent */ }

            // POST to endpoint (FIXED: redirect follow instead of no-cors)
            if (ENDPOINT && ENDPOINT !== 'PEGAR_AQUI_URL_WEB_APP') {
                fetch(ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload),
                    redirect: 'follow'
                })
                    .then(r => r.text())
                    .then(t => console.log('Datos enviados:', t))
                    .catch((err) => {
                        console.warn('Error enviando datos, guardado en localStorage:', err);
                    });
            } else {
                console.log('=== PAYLOAD (endpoint no configurado) ===');
                console.log(JSON.stringify(payload, null, 2));
            }
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        btnStart.addEventListener('click', () => {
            currentStep = 1;
            showScreen(quizScreen);
            renderQuestion(0);
        });

        btnNext.addEventListener('click', () => {
            const qIndex = currentStep - 1;
            if (answers[qIndex] === null) {
                validationMsg.classList.add('show');
                return;
            }

            // Cancel any pending auto-advance
            if (autoAdvanceTimeout) {
                clearTimeout(autoAdvanceTimeout);
                autoAdvanceTimeout = null;
            }

            direction = 'forward';

            if (currentStep < questions.length) {
                currentStep++;
                renderQuestion(currentStep - 1);
            } else {
                goToAnalyzing();
            }
        });

        btnPrev.addEventListener('click', () => {
            if (currentStep > 1) {
                // Cancel any pending auto-advance
                if (autoAdvanceTimeout) {
                    clearTimeout(autoAdvanceTimeout);
                    autoAdvanceTimeout = null;
                }
                direction = 'backward';
                currentStep--;
                renderQuestion(currentStep - 1);
            }
        });

        // Keyboard nav
        document.addEventListener('keydown', (e) => {
            if (quizScreen.classList.contains('hidden')) return;
            if (e.key === 'Enter' && !e.target.matches('textarea')) {
                e.preventDefault();
                btnNext.click();
            }
        });

        // Auto-save state
        let saveTimeout;
        function saveState() {
            try {
                localStorage.setItem('ginecospa_momento_state', JSON.stringify({
                    currentStep, answers, notes
                }));
            } catch (e) { /* silent */ }
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('ginecospa_momento_state');
                if (saved) {
                    const state = JSON.parse(saved);
                    if (state.answers && state.answers.length === questions.length) {
                        currentStep = state.currentStep || 0;
                        answers = state.answers;
                        notes = state.notes || new Array(questions.length).fill('');
                        if (currentStep > 0 && currentStep <= questions.length) {
                            showScreen(quizScreen);
                            renderQuestion(currentStep - 1);
                        }
                    }
                }
            } catch (e) { /* silent */ }
        }

        document.addEventListener('change', () => { clearTimeout(saveTimeout); saveTimeout = setTimeout(saveState, 500); });
        document.addEventListener('input', () => { clearTimeout(saveTimeout); saveTimeout = setTimeout(saveState, 500); });

        loadState();

    })();
    </script>

</body>
</html>
