<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GinecoSpa - An√°lisis completo: tu lectura profunda personalizada.">
    <title>GinecoSpa - An√°lisis Completo</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --rosa-palido: #FFF5F7;
            --rosa-claro: #FFE5EC;
            --rosa-medio: #FFB5C5;
            --rosa-intenso: #FF8FA3;
            --rosa-oscuro: #E75480;
            --rosa-profundo: #C9365E;
            --lavanda: #F3E8FF;
            --lavanda-medio: #E0CFFF;
            --gris-calido: #6B5D5D;
            --gris-suave: #9A8F8F;
            --crema: #FFF8F0;
            --blanco: #FFFFFF;
            --texto-principal: #3D2E2E;
            --texto-secundario: #7A6B6B;
            --sombra-rosa: rgba(231, 84, 128, 0.12);
            --sombra-suave: rgba(61, 46, 46, 0.06);
            --gradiente-hero: linear-gradient(135deg, #FFF5F7 0%, #FFE5EC 30%, #F3E8FF 70%, #FFF5F7 100%);
            --gradiente-boton: linear-gradient(135deg, #E75480 0%, #FF8FA3 100%);
            --gradiente-boton-hover: linear-gradient(135deg, #C9365E 0%, #E75480 100%);
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--texto-principal);
            background: var(--gradiente-hero);
            background-attachment: fixed;
            min-height: 100vh;
            line-height: 1.6;
        }
        h1, h2, h3, h4, h5, h6 { font-family: 'Cormorant Garamond', serif; font-weight: 600; line-height: 1.2; }
        .font-script { font-family: 'Dancing Script', cursive; }

        /* Background orbs */
        .bg-orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.25; pointer-events: none; z-index: 0; }
        .bg-orb-1 { width: 400px; height: 400px; background: var(--rosa-claro); top: -100px; right: -100px; animation: orbFloat 12s ease-in-out infinite; }
        .bg-orb-2 { width: 350px; height: 350px; background: var(--lavanda); bottom: -80px; left: -80px; animation: orbFloat 15s ease-in-out infinite reverse; }
        @keyframes orbFloat { 0%, 100% { transform: translate(0,0) scale(1); } 50% { transform: translate(20px,-15px) scale(1.03); } }

        /* Layout */
        .app-container { position: relative; z-index: 1; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 1.5rem 1rem; }

        /* Brand */
        .brand-header { text-align: center; margin-bottom: 1.5rem; animation: fadeSlideDown 0.8s var(--transition-smooth); }
        .brand-header .logo-text { font-family: 'Dancing Script', cursive; font-size: 2rem; color: var(--rosa-oscuro); text-decoration: none; }
        .brand-header .subtitle { font-size: 0.75rem; color: var(--gris-suave); letter-spacing: 3px; text-transform: uppercase; margin-top: 0.25rem; }

        /* Card */
        .main-card {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,229,236,0.6);
            border-radius: 28px;
            box-shadow: 0 4px 24px var(--sombra-rosa), 0 1px 3px var(--sombra-suave);
            width: 100%; max-width: 700px;
            padding: 2rem 1.5rem;
            position: relative; overflow: hidden;
        }
        .main-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background: var(--gradiente-boton); border-radius: 28px 28px 0 0; }
        @media (min-width: 640px) { .main-card { padding: 2.5rem 3rem; } }

        /* Animations */
        @keyframes fadeSlideDown { from { opacity:0; transform:translateY(-15px); } to { opacity:1; transform:translateY(0); } }
        @keyframes fadeSlideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes dotPulse { 0%,80%,100% { transform:scale(0.6); opacity:0.4; } 40% { transform:scale(1); opacity:1; } }

        /* Loading */
        .loading-screen { text-align: center; padding: 3rem 1rem; animation: fadeIn 0.5s; }
        .loading-spinner { width: 56px; height: 56px; border: 4px solid var(--rosa-claro); border-top-color: var(--rosa-oscuro); border-radius: 50%; margin: 0 auto 1.5rem; animation: spin 1s linear infinite; }
        .loading-dots { display: inline-flex; gap: 4px; margin-left: 4px; }
        .loading-dots span { width: 5px; height: 5px; background: var(--rosa-oscuro); border-radius: 50%; animation: dotPulse 1.4s ease-in-out infinite; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        .loading-title { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; color: var(--texto-principal); margin-bottom: 0.5rem; }
        .loading-sub { font-size: 0.85rem; color: var(--gris-suave); }

        /* Error */
        .error-screen { text-align: center; padding: 2rem 0; animation: fadeSlideUp 0.5s; }
        .error-icon { font-size: 3rem; margin-bottom: 1rem; display: block; }
        .error-title { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; color: var(--texto-principal); margin-bottom: 0.5rem; }
        .error-text { font-size: 0.9rem; color: var(--texto-secundario); margin-bottom: 1.5rem; line-height: 1.6; max-width: 400px; margin-left: auto; margin-right: auto; }
        .error-note { font-size: 0.8rem; color: var(--gris-suave); margin-top: 1rem; font-style: italic; }

        /* Buttons */
        .btn {
            padding: 0.85rem 1.8rem; border-radius: 50px; font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s var(--transition-smooth);
            border: none; display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;
        }
        .btn-primary { background: var(--gradiente-boton); color: var(--blanco); box-shadow: 0 4px 16px rgba(231,84,128,0.3); }
        .btn-primary:hover { background: var(--gradiente-boton-hover); box-shadow: 0 6px 24px rgba(231,84,128,0.4); transform: translateY(-1px); }
        .btn-secondary { background: var(--blanco); color: var(--gris-calido); border: 2px solid var(--rosa-claro); }
        .btn-secondary:hover { border-color: var(--rosa-medio); background: var(--rosa-palido); color: var(--rosa-oscuro); }
        .btn-ghost { background: none; border: none; color: var(--gris-suave); font-size: 0.85rem; cursor: pointer; font-family: 'Montserrat', sans-serif; padding: 0.5rem; transition: color 0.2s; }
        .btn-ghost:hover { color: var(--rosa-oscuro); }
        .btn-group { display: flex; flex-direction: column; gap: 0.75rem; align-items: center; margin-top: 1rem; }
        @media (min-width: 480px) { .btn-group { flex-direction: row; justify-content: center; } }

        /* Results content */
        .results-content { animation: fadeSlideUp 0.6s var(--transition-smooth); }
        .results-header { text-align: center; margin-bottom: 1.5rem; }
        .results-icon { font-size: 3rem; display: block; margin-bottom: 0.75rem; }
        .results-title { font-size: 1.6rem; color: var(--texto-principal); margin-bottom: 0.25rem; }
        .results-subtitle { font-family: 'Dancing Script', cursive; font-size: 1rem; color: var(--rosa-oscuro); }

        .level-badge {
            display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.5rem 1.2rem;
            border-radius: 50px; font-size: 0.85rem; font-weight: 600; margin: 1rem auto;
        }
        .level-ajuste { background: linear-gradient(135deg,#E8F8F0,#D4EFDF); color: #2E7D5B; border: 1px solid #B8E6CC; }
        .level-carga { background: linear-gradient(135deg,#FFF8E1,#FFECB3); color: #C77A00; border: 1px solid #FFD54F; }
        .level-desgaste { background: linear-gradient(135deg,#FFEBEE,#FFCDD2); color: #C62828; border: 1px solid #EF9A9A; }
        .level-saturacion { background: linear-gradient(135deg,#EDE7F6,#D1C4E9); color: #6A1B9A; border: 1px solid #CE93D8; }

        .divider { height: 1px; background: linear-gradient(to right, transparent, var(--rosa-claro), transparent); margin: 1.5rem 0; }

        /* Section blocks */
        .section-block {
            background: var(--blanco); border: 2px solid var(--rosa-claro); border-radius: 16px;
            padding: 1.5rem; margin-bottom: 1.25rem;
        }
        .section-block.highlight {
            background: linear-gradient(135deg, var(--rosa-palido), var(--lavanda));
            border-color: var(--lavanda-medio);
        }
        .section-block.accent {
            background: var(--rosa-palido);
            border-color: var(--rosa-claro);
        }
        .section-block h4 {
            font-family: 'Cormorant Garamond', serif; font-size: 1.15rem;
            color: var(--rosa-oscuro); margin-bottom: 0.75rem;
        }
        .section-block p, .section-block li {
            font-size: 0.88rem; color: var(--texto-secundario); line-height: 1.7;
        }
        .section-block .tag { font-weight: 600; color: var(--rosa-oscuro); }

        /* Day plan */
        .day-plan { padding: 0; list-style: none; }
        .day-plan li {
            display: flex; gap: 0.7rem; padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255,229,236,0.5);
            font-size: 0.85rem; color: var(--texto-secundario); align-items: flex-start;
        }
        .day-plan li:last-child { border-bottom: none; }
        .day-label { font-weight: 700; color: var(--rosa-oscuro); min-width: 50px; flex-shrink: 0; }

        /* Limits */
        .limit-item {
            display: flex; align-items: flex-start; gap: 0.6rem;
            padding: 0.5rem 0; font-size: 0.85rem; color: var(--texto-secundario);
        }
        .limit-item span:first-child { font-size: 1rem; flex-shrink: 0; }

        /* Summary row */
        .summary-item {
            display: flex; align-items: flex-start; gap: 0.6rem;
            padding: 0.4rem 0; font-size: 0.88rem; color: var(--texto-principal); line-height: 1.5;
        }
        .summary-item strong { color: var(--rosa-oscuro); font-weight: 600; }

        /* Footer */
        .app-footer { text-align: center; margin-top: 2rem; padding: 1rem; font-size: 0.7rem; color: var(--gris-suave); }
        .app-footer a { color: var(--rosa-oscuro); text-decoration: none; }
        .app-footer .disclaimer { max-width: 500px; margin: 0.5rem auto 0; line-height: 1.5; font-size: 0.65rem; opacity: 0.7; }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <div class="app-container">
        <header class="brand-header">
            <a href="index.html" class="logo-text">GinecoSpa</a>
            <div class="subtitle">An√°lisis Completo</div>
        </header>

        <main class="main-card">

            <!-- LOADING -->
            <section id="loadingScreen">
                <div class="loading-screen">
                    <div class="loading-spinner"></div>
                    <p class="loading-title">
                        Verificando tu acceso
                        <span class="loading-dots"><span></span><span></span><span></span></span>
                    </p>
                    <p class="loading-sub">Un momento, estamos confirmando tu pago</p>
                </div>
            </section>

            <!-- ERROR / NOT PAID -->
            <section id="errorScreen" class="hidden">
                <div class="error-screen">
                    <span class="error-icon">üîí</span>
                    <h2 class="error-title">A√∫n no vemos el pago confirmado</h2>
                    <p class="error-text">
                        Si acabas de pagar, es posible que tome unos segundos en procesarse.
                        Puedes reintentar la verificaci√≥n o volver a intentar el pago.
                    </p>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="btnRetry">
                            ‚Üª Reintentar verificaci√≥n
                        </button>
                        <a href="PEGAR_AQUI_STRIPE_PAYMENT_LINK" class="btn btn-secondary" id="btnRepay">
                            Volver a pagar
                        </a>
                    </div>
                    <div style="margin-top: 1rem;">
                        <a href="que-esta-pasando-conmigo.html" class="btn-ghost">‚Üê Volver a mi resultado</a>
                    </div>
                    <p class="error-note">Si el problema persiste, escr√≠benos y te ayudamos.</p>
                </div>
            </section>

            <!-- NO DATA -->
            <section id="noDataScreen" class="hidden">
                <div class="error-screen">
                    <span class="error-icon">üìã</span>
                    <h2 class="error-title">No encontramos tus respuestas</h2>
                    <p class="error-text">
                        Parece que abriste esta p√°gina desde otro navegador o dispositivo.
                        Necesitas completar el test primero para ver tu an√°lisis.
                    </p>
                    <div class="btn-group">
                        <a href="que-esta-pasando-conmigo.html" class="btn btn-primary">
                            Hacer el test ‚Üí
                        </a>
                    </div>
                </div>
            </section>

            <!-- RESULTS - LEVEL 2 -->
            <section id="resultsScreen" class="hidden">
                <div class="results-content" id="resultsContent"></div>
            </section>

        </main>

        <footer class="app-footer">
            <p><a href="index.html" class="font-script" style="font-size:0.9rem;">GinecoSpa</a> ¬∑ Bienestar √çntimo y Est√©tico</p>
            <p class="disclaimer">
                Este an√°lisis no constituye un diagn√≥stico m√©dico ni sustituye la evaluaci√≥n profesional.
                Es una herramienta de orientaci√≥n general. No es emergencia.
            </p>
        </footer>
    </div>

<script>
(() => {
    'use strict';

    // ============================================
    // ENDPOINTS (pegar URLs reales despu√©s)
    // ============================================
    const VERIFY_ENDPOINT = "PEGAR_AQUI_URL_WEB_APP_VERIFY";
    const STRIPE_PAYMENT_LINK = "PEGAR_AQUI_STRIPE_PAYMENT_LINK";

    // ============================================
    // AREA LABELS
    // ============================================
    const areaLabels = [
        'Estabilidad emocional', 'Energ√≠a vital', 'Claridad de rumbo',
        'Carga mental', 'Gesti√≥n emocional', 'Alineaci√≥n con prop√≥sito',
        'Peso de responsabilidades', 'Espacio personal', 'Red de apoyo', 'Conexi√≥n interna'
    ];

    // ============================================
    // QUESTIONS (needed for re-calc)
    // ============================================
    const questionOptions = [
        [{s:0},{s:1},{s:2},{s:3}], [{s:0},{s:1},{s:2},{s:3}],
        [{s:0},{s:1},{s:2},{s:3}], [{s:0},{s:1},{s:2},{s:3}],
        [{s:0},{s:1},{s:2},{s:3}], [{s:0},{s:1},{s:2},{s:3}],
        [{s:0},{s:1},{s:2},{s:3}], [{s:0},{s:1},{s:2},{s:3}],
        [{s:0},{s:1},{s:2},{s:3}], [{s:0},{s:1},{s:2},{s:3}]
    ];

    // ============================================
    // PROFILES
    // ============================================
    const profiles = {
        A: { label:'Ajuste saludable', icon:'üåø', badgeClass:'level-ajuste', title:'Est√°s en un buen momento' },
        B: { label:'Carga moderada', icon:'üå§Ô∏è', badgeClass:'level-carga', title:'Est√°s cargando m√°s de lo que crees' },
        C: { label:'Desgaste emocional', icon:'üåßÔ∏è', badgeClass:'level-desgaste', title:'Tu cuerpo ya te est√° hablando' },
        D: { label:'Saturaci√≥n / desconexi√≥n', icon:'üåë', badgeClass:'level-saturacion', title:'Necesitas atenci√≥n, y est√° bien' }
    };

    // ============================================
    // PATTERN RULES (same as quiz)
    // ============================================
    const patternRules = [
        { id:'saturacion_cero_pausa', check:(a)=>a[3]>=2&&a[7]>=2, name:'Saturaci√≥n + cero pausa',
          signal:'Tu mente no para y no tienes espacio para ti.', step:'Crear espacio de silencio diario.' },
        { id:'sostener_sola', check:(a)=>a[8]>=2&&(a[4]>=2||a[9]>=2), name:'Sostener sola / desconexi√≥n emocional',
          signal:'Llevas demasiado tiempo sosteniendo sin pedir ayuda.', step:'Habla con alguien esta semana.' },
        { id:'desconexion_rumbo', check:(a)=>a[2]>=2&&a[9]>=2, name:'Desconexi√≥n de rumbo',
          signal:'No sabes hacia d√≥nde ir. La falta de claridad drena m√°s que el esfuerzo.', step:'Detenerte y preguntarte: ¬øqu√© quiero realmente?' },
        { id:'desgaste_carga', check:(a)=>a[1]>=2&&a[6]>=2, name:'Desgaste por carga sostenida',
          signal:'Tu energ√≠a baja y responsabilidades altas crean un ciclo de agotamiento.', step:'Soltar o delegar 1 responsabilidad esta semana.' }
    ];
    const defaultPattern = { id:'ajuste_transicion', name:'Ajuste interno / transici√≥n',
        signal:'Est√°s en un momento de reacomodaci√≥n natural.', step:'S√© paciente contigo.' };

    // ============================================
    // LEVEL 2 DEEP CONTENT (deterministic, per pattern)
    // ============================================
    const deepContent = {
        saturacion_cero_pausa: {
            fuga: 'Tu mayor fuga de energ√≠a est√° en la incapacidad de frenar. No es que tengas "mucho que hacer" ‚Äî es que tu sistema ya no distingue entre urgente e importante. Todo se siente igual de pesado porque tu mente est√° en modo alerta permanente. Cada tarea consume el doble porque no hay descanso real entre una y otra.',
            reparacion: 'Antes de intentar "organizarte mejor", necesitas regular tu sistema nervioso. Tu prioridad no es la productividad ‚Äî es el silencio. Tu cuerpo necesita momentos sin est√≠mulos, sin decisiones, sin pantallas. Hasta que no le des eso, cualquier estrategia de organizaci√≥n va a fallar porque est√°s operando desde la saturaci√≥n.',
            plan: [
                { day:'D√≠a 1', task:'Elige un momento del d√≠a (ma√±ana o noche) y bloquea 15 minutos sin tel√©fono, sin tareas. Solo estar.' },
                { day:'D√≠a 2', task:'Escribe en un papel todo lo que sientes que "tienes que hacer". No lo ordenes ‚Äî solo s√°calo de la cabeza.' },
                { day:'D√≠a 3', task:'De esa lista, tacha 3 cosas que puedes no hacer esta semana. Da permiso real de soltar.' },
                { day:'D√≠a 4', task:'Camina 20 minutos sin auriculares. Deja que la mente divague sin dirigirla.' },
                { day:'D√≠a 5', task:'Di "no" a algo hoy. Puede ser peque√±o: una reuni√≥n, un favor, un compromiso social.' },
                { day:'D√≠a 6', task:'Haz algo solo por placer, no por utilidad. Leer, cocinar, dibujar ‚Äî lo que sea sin prop√≥sito productivo.' },
                { day:'D√≠a 7', task:'Revisa c√≥mo te sentiste esta semana. ¬øQu√© d√≠a fue m√°s f√°cil respirar? Repite eso.' }
            ],
            limites: [
                { icon:'üö´', text:'Deja de revisar mensajes y correos fuera de horario. Tu disponibilidad constante te est√° drenando.' },
                { icon:'üö´', text:'Deja de decir "s√≠" autom√°ticamente. Antes de aceptar algo, preg√∫ntate: ¬øesto me suma o me resta?' },
                { icon:'üö´', text:'Deja de llenar cada momento libre con una tarea. El tiempo vac√≠o no es tiempo perdido ‚Äî es tiempo de reparaci√≥n.' }
            ]
        },
        sostener_sola: {
            fuga: 'Lo que m√°s energ√≠a te quita no es lo que haces ‚Äî es lo que cargas en silencio. Hay una parte de ti que decidi√≥ (probablemente hace tiempo) que pedir ayuda es una carga para los dem√°s. Esa creencia te est√° aislando emocionalmente, incluso rodeada de gente. La tristeza o desconexi√≥n que sientes no es "debilidad" ‚Äî es el costo de sostener sola.',
            reparacion: 'Tu prioridad esta semana no es resolver nada ‚Äî es dejar de cargar sola. Eso significa una cosa: hablar. No para pedir soluciones, no para que alguien te arregle, sino para que lo que llevas dentro deje de ser solo tuyo. El primer paso es romper el silencio, aunque sea en una sola conversaci√≥n.',
            plan: [
                { day:'D√≠a 1', task:'Identifica 1 persona de confianza. No la "mejor" ‚Äî alguien con quien te sientas segura hablando.' },
                { day:'D√≠a 2', task:'Escr√≠bele un mensaje simple: "¬øTienes un rato esta semana? Necesito hablar de algo."' },
                { day:'D√≠a 3', task:'Escribe lo que sientes en un papel, sin filtro. No para enviar ‚Äî para ti.' },
                { day:'D√≠a 4', task:'Haz algo que te conecte con tu cuerpo: caminar, estirarte, ba√±arte con calma.' },
                { day:'D√≠a 5', task:'Ten esa conversaci√≥n. No necesitas "explicar todo" ‚Äî solo empieza: "√öltimamente me siento‚Ä¶"' },
                { day:'D√≠a 6', task:'Observa c√≥mo te sentiste despu√©s de hablar. Anota una cosa que cambi√≥, por peque√±a que sea.' },
                { day:'D√≠a 7', task:'Preg√∫ntate: ¬øqu√© necesitar√≠a para no volver a cargar sola tanto tiempo?' }
            ],
            limites: [
                { icon:'üö´', text:'Deja de responder "estoy bien" cuando no lo est√°s. Esa frase se convirti√≥ en una barrera.' },
                { icon:'üö´', text:'Deja de anteponer las necesidades de todos a las tuyas. Cuidar de ti no es ego√≠smo.' },
                { icon:'üö´', text:'Deja de comparar tu dolor con el de otros. Lo que sientes es v√°lido sin necesidad de justificarlo.' }
            ]
        },
        desconexion_rumbo: {
            fuga: 'Tu principal fuga de energ√≠a es la indecisi√≥n. No es que te falte capacidad ‚Äî es que no tienes claro hacia d√≥nde ir, y eso hace que cada paso se sienta in√∫til. La falta de direcci√≥n no es pereza: es una se√±al de que algo importante cambi√≥ dentro de ti y todav√≠a no lo has procesado.',
            reparacion: 'Antes de tomar decisiones grandes, necesitas reconectar con lo que quieres. No lo que "deber√≠as" querer, ni lo que otros esperan ‚Äî lo que t√∫ necesitas. Eso requiere silencio, honestidad contigo, y permiso para no tener todas las respuestas todav√≠a.',
            plan: [
                { day:'D√≠a 1', task:'Escribe 3 cosas que te hac√≠an sentir vivo/a hace un a√±o. ¬øSiguen presentes?' },
                { day:'D√≠a 2', task:'Anota qu√© cosas haces hoy por obligaci√≥n vs. por elecci√≥n. S√© honesto/a.' },
                { day:'D√≠a 3', task:'Completa esta frase 5 veces: "Si no tuviera miedo, yo‚Ä¶"' },
                { day:'D√≠a 4', task:'Dedica 20 minutos a hacer algo que disfrutas sin pensar en si "sirve para algo".' },
                { day:'D√≠a 5', task:'Habla con alguien sobre lo que est√°s sintiendo ‚Äî no sobre lo que "deber√≠as" hacer.' },
                { day:'D√≠a 6', task:'Elimina 1 compromiso que ya no te representa. Da espacio a lo que viene.' },
                { day:'D√≠a 7', task:'Escribe: "Lo que m√°s necesito ahora es‚Ä¶" y responde sin pensar demasiado.' }
            ],
            limites: [
                { icon:'üö´', text:'Deja de forzar decisiones que no est√°s listo/a para tomar. La claridad no se apura.' },
                { icon:'üö´', text:'Deja de comparar tu proceso con el de otros. Tu tiempo es tuyo.' },
                { icon:'üö´', text:'Deja de ignorar lo que sientes para "seguir funcionando". Lo que ignoras, crece.' }
            ]
        },
        desgaste_carga: {
            fuga: 'Lo que m√°s te drena es el ciclo de responsabilidad sin pausa. Cumples, entregas, sostienes ‚Äî pero tu cuerpo lleva la cuenta. La energ√≠a baja no es falta de disciplina: es tu organismo diciendo "basta". Est√°s operando en d√©ficit y cada d√≠a el margen es m√°s peque√±o.',
            reparacion: 'Tu cuerpo necesita lo b√°sico antes que cualquier otra cosa: dormir, comer, moverse. No es un consejo motivacional ‚Äî es biolog√≠a. Tu sistema est√° pidiendo reparaci√≥n, y hasta que no se la des, seguir√°s rindiendo cada vez menos con cada vez m√°s esfuerzo.',
            plan: [
                { day:'D√≠a 1', task:'Acu√©state 30 minutos antes de lo habitual. Sin pantalla. Solo descanso.' },
                { day:'D√≠a 2', task:'Identifica tu responsabilidad m√°s pesada y preg√∫ntate: ¬øpuedo delegar una parte?' },
                { day:'D√≠a 3', task:'Come 3 veces hoy con calma. Sin multitarea. Presta atenci√≥n a lo que comes.' },
                { day:'D√≠a 4', task:'Cancela o posterga 1 compromiso no esencial. Usa ese tiempo para descansar.' },
                { day:'D√≠a 5', task:'Mueve tu cuerpo 20 minutos: caminar, estirar, bailar. No como ejercicio ‚Äî como descarga.' },
                { day:'D√≠a 6', task:'Escribe todo lo que te pesa hoy. Luego marca: ¬øcu√°les son realmente m√≠os?' },
                { day:'D√≠a 7', task:'Haz un balance: ¬ødorm√≠ mejor? ¬øsolt√© algo? ¬øQu√© d√≠a me sent√≠ con m√°s aire?' }
            ],
            limites: [
                { icon:'üö´', text:'Deja de sacrificar sue√±o por productividad. El descanso no es negociable.' },
                { icon:'üö´', text:'Deja de asumir responsabilidades de otros. No todo depende de ti.' },
                { icon:'üö´', text:'Deja de posponer tu bienestar para "cuando tenga tiempo". El tiempo es ahora.' }
            ]
        },
        ajuste_transicion: {
            fuga: 'Tu energ√≠a se diluye en peque√±as incertidumbres acumuladas. No hay una sola cosa que te drena ‚Äî es la suma de ajustes pendientes, decisiones a medias, y un ritmo que todav√≠a no encuentra su comp√°s. Es como caminar con los zapatos un poco sueltos: no duele, pero te cansa.',
            reparacion: 'Necesitas dar estructura a lo que est√°s viviendo. No porque algo est√© mal, sino porque la transici√≥n requiere intenci√≥n. Tu prioridad es ordenar, no arreglar. Cuando las cosas tienen nombre y lugar, el peso baja.',
            plan: [
                { day:'D√≠a 1', task:'Escribe 3 cosas que sientes "en el aire" ‚Äî lo que no est√° resuelto ni definido.' },
                { day:'D√≠a 2', task:'Elige 1 de esas 3 y toma una microdecisi√≥n al respecto. No tiene que ser definitiva.' },
                { day:'D√≠a 3', task:'Haz algo que te haga sentir "t√∫" ‚Äî un h√°bito antiguo, una canci√≥n, un lugar.' },
                { day:'D√≠a 4', task:'Dedica 10 minutos a pensar: ¬øqu√© quiero que se sienta diferente en un mes?' },
                { day:'D√≠a 5', task:'Habla con alguien sobre c√≥mo te sientes. No sobre qu√© "hacer" ‚Äî sobre c√≥mo est√°s.' },
                { day:'D√≠a 6', task:'Suelta una expectativa. Algo que "deber√≠as" estar haciendo pero no necesitas ahora.' },
                { day:'D√≠a 7', task:'Revisa la semana. ¬øQu√© microdecisi√≥n te dio m√°s paz? Haz m√°s de eso.' }
            ],
            limites: [
                { icon:'üö´', text:'Deja de exigirte tener todo claro ya. El ajuste es un proceso, no un destino.' },
                { icon:'üö´', text:'Deja de llenar la agenda para no pensar. El espacio vac√≠o es donde llega la claridad.' },
                { icon:'üö´', text:'Deja de minimizar lo que sientes con "no es para tanto". Lo que sientes importa.' }
            ]
        }
    };

    // ============================================
    // DOM
    // ============================================
    const $ = sel => document.querySelector(sel);
    const loadingScreen = $('#loadingScreen');
    const errorScreen = $('#errorScreen');
    const noDataScreen = $('#noDataScreen');
    const resultsScreen = $('#resultsScreen');

    function show(screen) {
        [loadingScreen, errorScreen, noDataScreen, resultsScreen].forEach(s => s.classList.add('hidden'));
        screen.classList.remove('hidden');
    }

    // ============================================
    // RECALCULATE FROM PAYLOAD
    // ============================================
    function recalcFromPayload(payload) {
        const scores = payload.answers.map(a => a.score);
        const totalScore = payload.score_total;
        const profileKey = payload.perfil;
        const profile = profiles[profileKey];

        // Top 2 areas
        const indexed = scores.map((s, i) => ({ index: i, score: s }));
        indexed.sort((a, b) => b.score - a.score || a.index - b.index);
        const topAreas = [indexed[0].index, indexed[1].index];

        // Pattern
        let pattern = defaultPattern;
        for (const rule of patternRules) {
            if (rule.check(scores)) { pattern = rule; break; }
        }

        // Focus
        let focus;
        if (profileKey === 'D') focus = 'Recuperar conexi√≥n contigo antes de intentar resolver lo externo.';
        else if (profileKey === 'C') focus = 'Frenar el desgaste: descanso, l√≠mites, y una conversaci√≥n honesta contigo.';
        else if (topAreas.includes(3) || topAreas.includes(7)) focus = 'Reducir la sobrecarga mental y crear espacio para procesar.';
        else if (topAreas.includes(8) || topAreas.includes(4)) focus = 'Reconectar con lo que sientes y necesitas realmente.';
        else if (profileKey === 'B') focus = 'Ordenar prioridades y proteger tu energ√≠a antes de que se agote.';
        else focus = 'Mantener lo que funciona y estar atento/a a lo que necesita ajuste.';

        return { totalScore, profileKey, profile, scores, topAreas, pattern, focus };
    }

    // ============================================
    // RENDER LEVEL 2
    // ============================================
    function renderResults(data) {
        const deep = deepContent[data.pattern.id] || deepContent['ajuste_transicion'];
        const container = $('#resultsContent');

        container.innerHTML = `
            <!-- Header -->
            <div class="results-header">
                <span class="results-icon">${data.profile.icon}</span>
                <h1 class="results-title">Tu an√°lisis completo</h1>
                <p class="results-subtitle">Lectura profunda personalizada</p>
            </div>

            <div style="text-align:center;">
                <span class="level-badge ${data.profile.badgeClass}">
                    ${data.profile.icon} ${data.profile.label}
                </span>
            </div>

            <!-- Resumen r√°pido -->
            <div class="section-block accent">
                <h4>üìå Tu resumen</h4>
                <div class="summary-item">
                    <span>üéØ</span>
                    <span><strong>Patr√≥n principal:</strong> ${data.pattern.name}</span>
                </div>
                <div class="summary-item">
                    <span>üìä</span>
                    <span><strong>√Åreas m√°s altas:</strong> ${areaLabels[data.topAreas[0]]} y ${areaLabels[data.topAreas[1]]}</span>
                </div>
                <div class="summary-item">
                    <span>üîç</span>
                    <span><strong>Tu foco hoy:</strong> ${data.focus}</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Fuga de energ√≠a -->
            <div class="section-block highlight">
                <h4>‚ö° Fuga de energ√≠a #1</h4>
                <p>${deep.fuga}</p>
            </div>

            <!-- Prioridad de reparaci√≥n -->
            <div class="section-block highlight">
                <h4>üîß Prioridad de reparaci√≥n</h4>
                <p>${deep.reparacion}</p>
            </div>

            <div class="divider"></div>

            <!-- Plan de 7 d√≠as -->
            <div class="section-block">
                <h4>üìÖ Tu plan de 7 d√≠as</h4>
                <p style="margin-bottom:0.75rem; font-size:0.82rem; color:var(--gris-suave);">
                    Un paso por d√≠a. Sin prisa. Cada uno construye sobre el anterior.
                </p>
                <ul class="day-plan">
                    ${deep.plan.map(d => `
                        <li>
                            <span class="day-label">${d.day}</span>
                            <span>${d.task}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>

            <div class="divider"></div>

            <!-- L√≠mites recomendados -->
            <div class="section-block">
                <h4>üõë L√≠mites recomendados</h4>
                <p style="margin-bottom:0.75rem; font-size:0.82rem; color:var(--gris-suave);">
                    3 cosas que necesitas dejar de hacer para proteger tu energ√≠a:
                </p>
                ${deep.limites.map(l => `
                    <div class="limit-item">
                        <span>${l.icon}</span>
                        <span>${l.text}</span>
                    </div>
                `).join('')}
            </div>

            <div class="divider"></div>

            <!-- Cierre -->
            <div class="section-block accent" style="text-align:center;">
                <h4>üíú Una √∫ltima cosa</h4>
                <p>
                    Este an√°lisis es un punto de partida, no una sentencia. Lo que sientes tiene sentido,
                    tiene nombre, y tiene camino. El hecho de que est√©s aqu√≠ leyendo esto ya dice algo
                    importante sobre ti: est√°s prestando atenci√≥n. Y eso es m√°s de lo que la mayor√≠a se permite.
                </p>
            </div>

            <!-- Back -->
            <div style="text-align:center; margin-top:1.5rem;">
                <a href="que-esta-pasando-conmigo.html" class="btn-ghost">‚Üê Volver al test</a>
            </div>
        `;

        show(resultsScreen);
    }

    // ============================================
    // VERIFY PAYMENT
    // ============================================
    async function verifyPayment(sid) {
        // If endpoint not configured, show error
        if (!VERIFY_ENDPOINT || VERIFY_ENDPOINT === 'PEGAR_AQUI_URL_WEB_APP_VERIFY') {
            console.warn('Verify endpoint not configured');
            return false;
        }

        try {
            const resp = await fetch(`${VERIFY_ENDPOINT}?sid=${encodeURIComponent(sid)}`, {
                method: 'GET'
            });
            const json = await resp.json();
            return json && json.ok === true && json.paid === true;
        } catch (err) {
            console.error('Verification error:', err);
            return false;
        }
    }

    // ============================================
    // MAIN FLOW
    // ============================================
    async function init() {
        const params = new URLSearchParams(window.location.search);
        const paid = params.get('paid');
        const sid = params.get('sid');

        // Must have paid param and session id
        if (paid !== '1' || !sid) {
            show(errorScreen);
            return;
        }

        // Verify payment
        const verified = await verifyPayment(sid);
        if (!verified) {
            show(errorScreen);
            return;
        }

        // Load quiz data from localStorage
        let payload;
        try {
            const raw = localStorage.getItem('ginecospa_momento_vital_backup');
            payload = raw ? JSON.parse(raw) : null;
        } catch (e) {
            payload = null;
        }

        if (!payload || !payload.answers || !payload.perfil) {
            show(noDataScreen);
            return;
        }

        // Recalculate and render
        const data = recalcFromPayload(payload);
        renderResults(data);
    }

    // Retry button
    document.addEventListener('DOMContentLoaded', () => {
        const btnRetry = $('#btnRetry');
        if (btnRetry) {
            btnRetry.addEventListener('click', () => {
                show(loadingScreen);
                setTimeout(init, 1000);
            });
        }
        // Set Stripe link on repay button
        const btnRepay = $('#btnRepay');
        if (btnRepay && STRIPE_PAYMENT_LINK !== 'PEGAR_AQUI_STRIPE_PAYMENT_LINK') {
            btnRepay.href = STRIPE_PAYMENT_LINK;
        }
    });

    // Start
    init();

})();
</script>
</body>
</html>
